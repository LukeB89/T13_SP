{"ast":null,"code":"var _jsxFileName = \"/Users/evanbyrnes/Pycharm-python-workspace/T13_SP/client/src/App.js\";\n// Importing outside developed components.\nimport React, { useState } from \"react\";\nimport { useLoadScript, GoogleMap, Marker, InfoWindow, MarkerClusterer, DirectionsRenderer, DirectionsService } from \"@react-google-maps/api\";\nimport Row from \"react-bootstrap/Row\";\nimport Col from \"react-bootstrap/Col\";\nimport Container from \"react-bootstrap/Container\";\nimport Spinner from \"react-bootstrap/Spinner\"; // Importing self-developed components.\n\nimport CustomNavBar from \"./components/CustomNavBar\";\nimport FilterRoute from \"./components/FilterRoute\";\nimport StopSearch from \"./components/StopSearch\";\nimport Locate from \"./components/Locate\";\nimport PredictionInput from \"./components/PredictionInput\";\nimport RtpiApi from \"./components/RtpiApi\"; // Importing outside developed css.\n\nimport \"bootstrap/dist/css/bootstrap.min.css\";\nimport \"@reach/combobox/styles.css\"; // Importing Google Maps Api Key.\n\nimport googleMapApiKey from \"./config\"; // Defining libraries for Google Places\n\nconst libraries = [\"places\"]; // Importing the Dublin Bus API stops data\n\nconst data = require(\"./data/DublinBusStops.json\"); // // consts: [53.349804, -6.260310] - Dublin\n\n\nconst dublinCenter = require(\"./data/DublinCenter.json\"); // Importing custom styles to customize the style of Google Map...\n// important for including and excluding certain place markers etc.\n\n\nconst styles = require(\"./data/GoogleMapStyles.json\"); // Defined custom styles and location for Google Map.\n\n\nconst mapOptions = {\n  styles: styles,\n  disableDefaultUI: true,\n  zoomControl: true,\n  maxZoom: 17,\n  minZoom: 11\n};\nconst mapContainerStyle = {\n  height: \"93vh\"\n}; // Icon used to represent a bus stop on the map.\n\nconst icon = {\n  url: \"/bus_icon.svg\",\n  scaledSize: {\n    width: 18,\n    height: 18\n  }\n}; // Icons used when Markers are clustered.\n\nconst options = {\n  imagePath: \"https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m\"\n}; // Parsing the Stops data into various object shapes.\n\nconst rawData = data.results;\nconst myStops = rawData.map(stop => ({\n  description: \"Stop \" + stop.stopid + \", \" + stop.fullname,\n  type: \"Feature\",\n  properties: {\n    id: stop.stopid,\n    fullname: stop.fullname,\n    routes: stop.operators[0].routes\n  },\n  geometry: {\n    type: \"Point\",\n    pos: {\n      lat: parseFloat(stop.latitude),\n      lng: parseFloat(stop.longitude)\n    }\n  }\n}));\nconst parsedStops = myStops.map(parsed => ({\n  id: parsed.properties.id,\n  description: parsed.description,\n  geometry: parsed.geometry.pos\n}));\nconst stopDescriptions = [];\n\nfor (var i = 0; i < parsedStops.length; i++) {\n  stopDescriptions.push(parsedStops[i].description);\n}\n\nconst routesArray = [];\nconst duplicateRoutes = [];\n\nfor (var j = 0; j < myStops.length; j++) {\n  routesArray.push(myStops[j].properties.routes);\n}\n\nfor (var k = 0; k < routesArray.length; k++) {\n  for (var l = 0; l < routesArray[k].length; l++) {\n    duplicateRoutes.push(routesArray[k][l]);\n  }\n}\n\nconst allRoutes = duplicateRoutes.filter((a, b) => duplicateRoutes.indexOf(a) === b); // Main function for the SPA, generating the Map/Page.\n\nexport default function App() {\n  const {\n    isLoaded,\n    loadError\n  } = useLoadScript({\n    googleMapsApiKey: googleMapApiKey,\n    libraries\n  });\n  const center = dublinCenter; // eslint-disable-next-line\n\n  const [zoom, setZoom] = useState(11); // removing unwanted warning.\n  // The general things we need to track in state:\n\n  const [selectedPlace, setSelectedPlace] = useState(null);\n  const [markerMap, setMarkerMap] = useState({});\n  const [infoOpen, setInfoOpen] = useState(false);\n  const [geoMarkers, setGeoMarkers] = useState([]);\n  const [stopMarkers, setStopMarkers] = useState([]); // eslint-disable-next-line\n\n  const [selected, setSelected] = useState(null); // removing unwanted warning.\n  // Consider removing this variable stopNumber, see if it can be merged with either originNumber or destinationNumber.\n  // eslint-disable-next-line\n\n  const [stopNumber, setStopNumber] = useState(0); // removing unwanted warning.\n  // These are being used to track selected stop numbers\n\n  const [originNumber, setOriginNumber] = useState(0);\n  const [destinationNumber, setDestinationNumber] = useState(0); // This is used to track the string value of selected routes.\n\n  const [routeString, setRouteString] = useState(\"\"); // The things for Directions (Service and Renderer) we need to track in state.\n\n  const [response, setResponse] = useState(null);\n  const [responseValidator, setResponseValidator] = useState(false);\n  const [origin, setOrigin] = useState(\"\");\n  const [destination, setDestination] = useState(\"\"); // This is being used to track in state which set of markers is displayed. (Clusters or Route Markers)\n\n  const [markerSelection, setMarkerSelection] = useState(true); // The things for selected time (Hour, Day, Month) we need to track in state.\n\n  const [selectedTime, setSelectedTime] = useState(new Date()); // Setting the time, day and month values as the current time.\n  // This allows for user to make prediction for journey that occurs at\n  // this time without having to select the time.\n\n  const initialTime = selectedTime.toTimeString().substring(0, 2);\n  const initialMinute = selectedTime.toTimeString().substring(3, 5);\n  console.log(selectedTime.toTimeString().substring(3, 5));\n  const [initialDay, initialMonth] = selectedTime.toDateString().split(\" \"); // An array containing time data for model input.\n\n  const [timeDayMonth, setTimeDayMonth] = useState([initialTime, initialMinute, initialDay, initialMonth]); // Track state of user selected routes and directions.\n\n  const [routeSelect, setRouteSelect] = React.useState(\"\");\n  const [directionSelect, setDirectionSelect] = React.useState(undefined); // Track state of filtered bus stops.\n\n  const [filteredStops, setFilteredStops] = React.useState([]);\n  const [filteredStopsLatLng, setFilteredStopsLatLng] = React.useState([]);\n  const mapRef = React.useRef();\n  const onMapLoad = React.useCallback(map => {\n    mapRef.current = map;\n  }, []); // Orient the map to selected location.\n\n  const panTo = React.useCallback(({\n    lat,\n    lng\n  }) => {\n    mapRef.current.panTo({\n      lat,\n      lng\n    });\n    mapRef.current.setZoom(16);\n    setDestination(\"\");\n    setStopMarkers(current => [...current, {\n      lat: lat,\n      lng: lng\n    }]);\n  }, []); // Orient the map to selected location.\n\n  const panToGeoMarker = React.useCallback(({\n    lat,\n    lng\n  }) => {\n    mapRef.current.panTo({\n      lat,\n      lng\n    });\n    mapRef.current.setZoom(16); // Resetting the drawn route anytime this functions is called.\n\n    setDestination(\"\");\n    setGeoMarkers(current => [...current, {\n      lat: lat,\n      lng: lng\n    }]);\n  }, []); // We have to create a mapping of our places to actual Marker objects\n\n  const markerLoadHandler = (marker, stop) => {\n    return setMarkerMap(prevState => {\n      return { ...prevState,\n        [stop.properties.id]: marker\n      };\n    });\n  };\n\n  const markerClickHandler = (event, place) => {\n    // Remember which stop was clicked\n    setSelectedPlace(place); // Required so clicking a 2nd marker works as expected\n\n    if (infoOpen) {\n      setInfoOpen(false);\n    }\n\n    setInfoOpen(true);\n  }; // Changing stop realtime info based on user choice.\n\n\n  const stopChoice = number => {\n    setStopNumber(() => parseInt(number.id));\n  }; // Changing origin info based on user choice.\n\n\n  const originChoice = address => {\n    // console.log(\"originChoice triggered\", address);\n    setOrigin(() => address); // setOrigin(() => address.results[0].formatted_address);\n  }; // Changing destination info based on user choice.\n\n\n  const destinationChoice = address => {\n    // console.log(\"destinationChoice triggered\", address);\n    setDestination(() => address); // setDestination(() => address.results[0].formatted_address);\n  }; // Changing stops of route displayed on based on user choice.\n\n\n  const routeChoice = route => {\n    setRouteString(() => route.routeString);\n  };\n\n  const [distance, setDistance] = React.useState(null); // For generating a directions route on the map.\n\n  const directionsCallback = React.useCallback(response => {\n    // This is the array you want associated with\n    // the response instead of the one that google assigns.\n    const selectedRouteArray = [];\n    const notSelectedRouteArray = [];\n    var aCounter = 0;\n\n    if (response !== null && responseValidator === false) {\n      if (response.status === \"OK\") {\n        for (var i = 0; i < response.routes.length; i++) {\n          for (var j = 0; j < response.routes[i].legs.length; j++) {\n            for (var k = 0; k < response.routes[i].legs[j].steps.length; k++) {\n              if ( // making sure that WALKING is excluded since it will not contain bus name information\n              String(response.routes[i].legs[j].steps[k].travel_mode) === \"TRANSIT\" && // locating the first occurence of the users selected route\n              String(response.routes[i].legs[j].steps[k].transit.line.short_name) === routeSelect.toLowerCase()) {\n                aCounter++;\n                selectedRouteArray.push(response.routes[i]);\n              } else if ( // making sure that WALKING is excluded since it will not contain bus name information\n              String(response.routes[i].legs[j].steps[k].travel_mode) === \"TRANSIT\" && // locating the first occurence of the users selected route\n              String(response.routes[i].legs[j].steps[k].transit.line.short_name) !== routeSelect) {\n                notSelectedRouteArray.push(response.routes[i]);\n              }\n            }\n          }\n        }\n\n        if (aCounter >= 1) {\n          // setting the routes array to be the one containing our desired bus route.\n          response.routes = selectedRouteArray;\n        } else {\n          // setting the routes array to be the next avaialable bus route\n          response.routes = notSelectedRouteArray;\n        }\n\n        setResponse(() => ({\n          response\n        }));\n        setResponseValidator(true);\n      }\n\n      if (aCounter >= 1) {\n        setDistance(() => ({\n          selectedRouteArray: selectedRouteArray\n        }));\n      } else {\n        setDistance(() => ({\n          selectedRouteArray: notSelectedRouteArray\n        }));\n      }\n    }\n  }, // // here we are listening for changes in response\n  // // how about we make it to listen for changes in a variable\n  // eslint-disable-next-line\n  [response, distance, responseValidator] // react-hooks/exhaustive-deps\n  ); //  For which set of markers to display (Clusters or Route Markers).\n\n  const markerSelectionChoice = () => {\n    setMarkerSelection(() => false);\n  }; // For setting the selected origin stop number in state.\n\n\n  const originNumberChoice = number => {\n    console.log(\"originNumberChoice\", number);\n    setOriginNumber(() => parseInt(number.id));\n  }; // For setting the selected destination stop number in state.\n\n\n  const destinationNumberChoice = number => {\n    console.log(\"destinationNumberChoice\", number);\n    setDestinationNumber(() => parseInt(number.id));\n  }; // For setting the time in state.\n\n\n  const timeChoice = selectedTime => {\n    if (selectedTime === null) {\n      console.log(\"this dut has activated\");\n      const errorHandledDate = new Date();\n      const time = errorHandledDate.toTimeString().substring(0, 2);\n      const minute = errorHandledDate.toTimeString().substring(3, 5);\n      const [day, month] = errorHandledDate.toDateString().split(\" \");\n      setSelectedTime(errorHandledDate);\n      setTimeDayMonth([time, minute, day, month]);\n    } else {\n      const time = selectedTime.toTimeString().substring(0, 2);\n      const minute = selectedTime.toTimeString().substring(3, 5);\n      const [day, month] = selectedTime.toDateString().split(\" \");\n      setSelectedTime(selectedTime);\n      setTimeDayMonth([time, minute, day, month]);\n    }\n  }; // console.log(\"These are the time values: date-day-month\", timeDayMonth);\n\n\n  const filteredStopsChoice = filteredMarkers => {\n    setFilteredStops(() => filteredMarkers);\n  };\n\n  const filteredStopsLatLngChoice = filteredMarkers => {\n    setFilteredStopsLatLng(() => filteredMarkers);\n  }; // Orient the map to the selected route.\n  // Will need to have passed in to it an array of stop locations.\n\n\n  const panTwo = React.useCallback( // For some reason there is delay in this function receiving filteredStopsLatLng.\n  // You had this problem before, with the time. How the hell did you fix that?!\n  () => {\n    // console.log(newBounds, \"here is geometry in panTwo in App.js\");\n    // mapRef.current.fitBounds(newBounds);\n    // mapRef.current.setZoom(12);\n    // Resetting the drawn route anytime this functions is called.\n    setDestination(\"\");\n  }, []);\n  if (loadError) return \"Error\"; // if (!isLoaded) return <Loader type=\"line-scale\" active />;+\n\n  if (!isLoaded) return /*#__PURE__*/React.createElement(Spinner, {\n    animation: \"border\",\n    role: \"status\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 354,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"sr-only\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 355,\n      columnNumber: 9\n    }\n  }, \"Loading...\"));\n  return /*#__PURE__*/React.createElement(Container, {\n    fluid: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 360,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Row, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 361,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    sm: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 362,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(CustomNavBar // Passing in props - Custom built components.\n  , {\n    FilterRoute: FilterRoute,\n    StopSearch: StopSearch // Passing in props - Functions defined above.\n    ,\n    panTo: panTo,\n    stopChoice: stopChoice,\n    routeChoice: routeChoice,\n    panTwo: panTwo // Passing in props - Stop data defined above.\n    ,\n    parsedStops: parsedStops,\n    stopDescriptions: stopDescriptions,\n    allRoutes: allRoutes,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 363,\n      columnNumber: 11\n    }\n  }))), /*#__PURE__*/React.createElement(Row, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 379,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    lg: 9,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 380,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(GoogleMap // Inbuilt props: https://react-google-maps-api-docs.netlify.app/#googlemap.\n  , {\n    mapContainerStyle: mapContainerStyle,\n    center: center,\n    zoom: zoom,\n    options: mapOptions,\n    onLoad: onMapLoad,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 382,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Locate // Passing in props - Functions defined above.\n  , {\n    panToGeoMarker: panToGeoMarker,\n    setResponse: setResponse,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 390,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(RouteInfo // Passing in props - Functions defined above.\n  , {\n    markerLoadHandler: markerLoadHandler,\n    markerClickHandler: markerClickHandler,\n    markerSelectionChoice: markerSelectionChoice,\n    filteredStopsLatLngChoice: filteredStopsLatLngChoice,\n    mapRef: mapRef // Passing in props - Stop data defined above.\n    ,\n    routeString: routeString,\n    routeSelect: routeSelect,\n    filteredStopsChoice: filteredStopsChoice,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 395,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(ClusteredMarkers // Passing in props - Functions defined above.\n  , {\n    markerLoadHandler: markerLoadHandler,\n    markerClickHandler: markerClickHandler,\n    markerSelection: markerSelection // Passing in props - Stop data defined above.\n    ,\n    myStops: myStops,\n    setFilteredStops: setFilteredStops,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 407,\n      columnNumber: 13\n    }\n  }), infoOpen && selectedPlace && /*#__PURE__*/React.createElement(InfoWindow // Inbuilt props: https://react-google-maps-api-docs.netlify.app/#infowindow.\n  , {\n    anchor: markerMap[selectedPlace.properties.id],\n    onCloseClick: () => setInfoOpen(false),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 417,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 422,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"h5\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 423,\n      columnNumber: 19\n    }\n  }, selectedPlace.properties.fullname + \", stop \" + selectedPlace.properties.id), /*#__PURE__*/React.createElement(RtpiApi // Passing in props - Stop data defined above.\n  , {\n    number: selectedPlace.properties.id,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 428,\n      columnNumber: 19\n    }\n  }))), geoMarkers.map(marker => /*#__PURE__*/React.createElement(Marker // Inbuilt props: https://react-google-maps-api-docs.netlify.app/#marker.\n  , {\n    key: `${marker.lat}-${marker.lng}`,\n    position: {\n      lat: marker.lat,\n      lng: marker.lng\n    },\n    icon: {\n      url: \"http://maps.google.com/mapfiles/ms/icons/blue-dot.png\"\n    },\n    onClick: () => {\n      setSelected(marker);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 437,\n      columnNumber: 15\n    }\n  })), stopMarkers.map(marker => /*#__PURE__*/React.createElement(Marker // Inbuilt props: https://react-google-maps-api-docs.netlify.app/#marker.\n  , {\n    key: `${marker.lat}-${marker.lng}`,\n    position: {\n      lat: marker.lat,\n      lng: marker.lng\n    },\n    icon: {\n      url: \"http://maps.google.com/mapfiles/ms/icons/red-dot.png\"\n    },\n    onClick: () => {\n      setSelected(marker);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 452,\n      columnNumber: 15\n    }\n  })), destination !== \"\" && origin !== \"\" && /*#__PURE__*/React.createElement(DirectionsService // Inbuilt props: https://react-google-maps-api-docs.netlify.app/#directionsservice.\n  , {\n    options: {\n      destination: destination,\n      origin: origin,\n      travelMode: \"TRANSIT\",\n      provideRouteAlternatives: true,\n      transitOptions: {\n        modes: [\"BUS\"],\n        routingPreference: \"FEWER_TRANSFERS\",\n        // arrivalTime: new Date(1337675679473),\n        departureTime: selectedTime\n      } // transitDetails: { trip_short_name: \"145\" },\n\n    } // required\n    ,\n    callback: directionsCallback,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 465,\n      columnNumber: 15\n    }\n  }), response !== null && /*#__PURE__*/React.createElement(DirectionsRenderer // Inbuilt props: https://react-google-maps-api-docs.netlify.app/#directionsrenderer.\n  // required\n  , {\n    options: {\n      directions: response.response,\n      // hideRouteList: true,\n      polylineOptions: {\n        strokeColor: \"red\",\n        strokeWeight: 5\n      },\n      suppressInfoWindows: true,\n      suppressMarkers: false\n    } // panel={document.getElementById(\"panel\")}\n    // removing all displayed stops upon loading\n    ,\n    onLoad: () => {\n      // setRouteSelect(\"\");\n      setRouteString(\"\");\n      setMarkerSelection(false);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 485,\n      columnNumber: 15\n    }\n  }))), /*#__PURE__*/React.createElement(Col, {\n    lg: 3 // CSS\n    ,\n    style: {\n      paddingTop: \"2vh\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 509,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(PredictionInput // Passing in props - Functions defined above.\n  , {\n    panTo: panTo,\n    panTwo: panTwo,\n    originChoice: originChoice,\n    destinationChoice: destinationChoice,\n    originNumberChoice: originNumberChoice,\n    destinationNumberChoice: destinationNumberChoice,\n    timeChoice: timeChoice,\n    routeChoice: routeChoice // Passing in props - Variables defined above.\n    ,\n    setResponseValidator: setResponseValidator,\n    setStopMarkers: setStopMarkers,\n    setRouteString: setRouteString,\n    setGeoMarkers: setGeoMarkers,\n    setMarkerSelection: setMarkerSelection,\n    setFilteredStops: setFilteredStops,\n    setOrigin: setOrigin,\n    setDestination: setDestination,\n    originNumber: originNumber,\n    destinationNumber: destinationNumber,\n    selectedTime: selectedTime,\n    setSelectedTime: setSelectedTime,\n    timeDayMonth: timeDayMonth,\n    setTimeDayMonth: setTimeDayMonth,\n    routeSelect: routeSelect,\n    setRouteSelect: setRouteSelect,\n    directionSelect: directionSelect,\n    setDirectionSelect: setDirectionSelect,\n    setResponse: setResponse // Passing in props - Directions response defined above.\n    ,\n    distance: distance // Passing in props - Stop data defined above.\n    ,\n    parsedStops: parsedStops,\n    stopDescriptions: stopDescriptions,\n    allRoutes: allRoutes,\n    filteredStops: filteredStops,\n    filteredStopsLatLng: filteredStopsLatLng,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 514,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"panel\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 553,\n      columnNumber: 11\n    }\n  }))));\n} // Function that filters the markers on the map\n// according to a user selected route.\n\nfunction RouteInfo(props) {\n  // i want to be able to define this variable outside of this function.\n  // but it has to be populated in here.\n  // when it has been populated it shoiuld be set in App.\n  const filteredMarkers = [];\n  const filteredStopStrings = [];\n  const filteredStopsCoords = [];\n\n  for (var i = 0; i < myStops.length; i++) {\n    for (var j = 0; j < myStops[i].properties.routes.length; j++) {\n      if (String(myStops[i].properties.routes[j]) === props.routeString) {\n        filteredMarkers.push(myStops[i]);\n        filteredStopStrings.push(myStops[i].description);\n        filteredStopsCoords.push(myStops[i].geometry.pos);\n      }\n    }\n  }\n\n  const uniqueMarkers = filteredMarkers.filter((a, b) => filteredMarkers.indexOf(a) === b);\n  const bounds = new window.google.maps.LatLngBounds(); // create an empty new bounds object\n\n  for (i = 0; i < filteredStopsCoords.length; i++) {\n    bounds.extend(filteredStopsCoords[i]);\n  }\n\n  if (String(props.routeString) !== \"\") {\n    // console.log(filteredMarkers);\n    return uniqueMarkers.map(stop => /*#__PURE__*/React.createElement(Marker, {\n      icon: icon,\n      key: stop.properties.id,\n      position: stop.geometry.pos,\n      onLoad: marker => {\n        props.filteredStopsLatLngChoice(filteredStopsCoords);\n        props.filteredStopsChoice(filteredStopStrings); // Will do for now - removing cluster upon selection of route.\n\n        props.markerSelectionChoice(false);\n        props.markerLoadHandler(marker, stop); // Changing the bounds to fit map to chosen route's markers.\n\n        props.mapRef.current.fitBounds(bounds);\n        props.mapRef.current.setZoom(13);\n      },\n      onClick: event => {\n        props.markerClickHandler(event, stop);\n      },\n      animation: window.google.maps.Animation.DROP,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 591,\n        columnNumber: 7\n      }\n    }));\n  } else {\n    return null;\n  }\n} // Function that renders all of the Dublin Bus stops in clustered form.\n// props.markerSelection being set to True means that they will all be displayed on\n// the first load. When a route is chosen from the RouteInfo function above,\n// props.markerSelection gets set to False and all of the markers are removed. This solution\n// is intended only to be temporary until something better comes up.\n\n\nfunction ClusteredMarkers(props) {\n  if (props.markerSelection === true) {\n    return /*#__PURE__*/React.createElement(MarkerClusterer, {\n      options: options,\n      maxZoom: 15,\n      minimumClusterSize: 4,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 624,\n        columnNumber: 7\n      }\n    }, clusterer => props.myStops.map(stop => /*#__PURE__*/React.createElement(Marker, {\n      icon: icon,\n      key: stop.properties.id,\n      position: stop.geometry.pos,\n      clusterer: clusterer,\n      onLoad: marker => props.markerLoadHandler(marker, stop),\n      onClick: event => props.markerClickHandler(event, stop),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 627,\n        columnNumber: 13\n      }\n    })));\n  } else {\n    return null;\n  }\n}","map":{"version":3,"sources":["/Users/evanbyrnes/Pycharm-python-workspace/T13_SP/client/src/App.js"],"names":["React","useState","useLoadScript","GoogleMap","Marker","InfoWindow","MarkerClusterer","DirectionsRenderer","DirectionsService","Row","Col","Container","Spinner","CustomNavBar","FilterRoute","StopSearch","Locate","PredictionInput","RtpiApi","googleMapApiKey","libraries","data","require","dublinCenter","styles","mapOptions","disableDefaultUI","zoomControl","maxZoom","minZoom","mapContainerStyle","height","icon","url","scaledSize","width","options","imagePath","rawData","results","myStops","map","stop","description","stopid","fullname","type","properties","id","routes","operators","geometry","pos","lat","parseFloat","latitude","lng","longitude","parsedStops","parsed","stopDescriptions","i","length","push","routesArray","duplicateRoutes","j","k","l","allRoutes","filter","a","b","indexOf","App","isLoaded","loadError","googleMapsApiKey","center","zoom","setZoom","selectedPlace","setSelectedPlace","markerMap","setMarkerMap","infoOpen","setInfoOpen","geoMarkers","setGeoMarkers","stopMarkers","setStopMarkers","selected","setSelected","stopNumber","setStopNumber","originNumber","setOriginNumber","destinationNumber","setDestinationNumber","routeString","setRouteString","response","setResponse","responseValidator","setResponseValidator","origin","setOrigin","destination","setDestination","markerSelection","setMarkerSelection","selectedTime","setSelectedTime","Date","initialTime","toTimeString","substring","initialMinute","console","log","initialDay","initialMonth","toDateString","split","timeDayMonth","setTimeDayMonth","routeSelect","setRouteSelect","directionSelect","setDirectionSelect","undefined","filteredStops","setFilteredStops","filteredStopsLatLng","setFilteredStopsLatLng","mapRef","useRef","onMapLoad","useCallback","current","panTo","panToGeoMarker","markerLoadHandler","marker","prevState","markerClickHandler","event","place","stopChoice","number","parseInt","originChoice","address","destinationChoice","routeChoice","route","distance","setDistance","directionsCallback","selectedRouteArray","notSelectedRouteArray","aCounter","status","legs","steps","String","travel_mode","transit","line","short_name","toLowerCase","markerSelectionChoice","originNumberChoice","destinationNumberChoice","timeChoice","errorHandledDate","time","minute","day","month","filteredStopsChoice","filteredMarkers","filteredStopsLatLngChoice","panTwo","travelMode","provideRouteAlternatives","transitOptions","modes","routingPreference","departureTime","directions","polylineOptions","strokeColor","strokeWeight","suppressInfoWindows","suppressMarkers","paddingTop","RouteInfo","props","filteredStopStrings","filteredStopsCoords","uniqueMarkers","bounds","window","google","maps","LatLngBounds","extend","fitBounds","Animation","DROP","ClusteredMarkers","clusterer"],"mappings":"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","sourcesContent":["// Importing outside developed components.\nimport React, { useState } from \"react\";\nimport {\n  useLoadScript,\n  GoogleMap,\n  Marker,\n  InfoWindow,\n  MarkerClusterer,\n  DirectionsRenderer,\n  DirectionsService,\n} from \"@react-google-maps/api\";\nimport Row from \"react-bootstrap/Row\";\nimport Col from \"react-bootstrap/Col\";\nimport Container from \"react-bootstrap/Container\";\nimport Spinner from \"react-bootstrap/Spinner\";\n// Importing self-developed components.\nimport CustomNavBar from \"./components/CustomNavBar\";\nimport FilterRoute from \"./components/FilterRoute\";\nimport StopSearch from \"./components/StopSearch\";\nimport Locate from \"./components/Locate\";\nimport PredictionInput from \"./components/PredictionInput\";\nimport RtpiApi from \"./components/RtpiApi\";\n// Importing outside developed css.\nimport \"bootstrap/dist/css/bootstrap.min.css\";\nimport \"@reach/combobox/styles.css\";\n// Importing Google Maps Api Key.\nimport googleMapApiKey from \"./config\";\n// Defining libraries for Google Places\nconst libraries = [\"places\"];\n// Importing the Dublin Bus API stops data\nconst data = require(\"./data/DublinBusStops.json\");\n// // consts: [53.349804, -6.260310] - Dublin\nconst dublinCenter = require(\"./data/DublinCenter.json\");\n// Importing custom styles to customize the style of Google Map...\n// important for including and excluding certain place markers etc.\nconst styles = require(\"./data/GoogleMapStyles.json\");\n// Defined custom styles and location for Google Map.\nconst mapOptions = {\n  styles: styles,\n  disableDefaultUI: true,\n  zoomControl: true,\n  maxZoom: 17,\n  minZoom: 11,\n};\nconst mapContainerStyle = {\n  height: \"93vh\",\n};\n// Icon used to represent a bus stop on the map.\nconst icon = {\n  url: \"/bus_icon.svg\",\n  scaledSize: { width: 18, height: 18 },\n};\n// Icons used when Markers are clustered.\nconst options = {\n  imagePath:\n    \"https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m\",\n};\n// Parsing the Stops data into various object shapes.\nconst rawData = data.results;\n\nconst myStops = rawData.map((stop) => ({\n  description: \"Stop \" + stop.stopid + \", \" + stop.fullname,\n  type: \"Feature\",\n  properties: {\n    id: stop.stopid,\n    fullname: stop.fullname,\n    routes: stop.operators[0].routes,\n  },\n  geometry: {\n    type: \"Point\",\n    pos: {\n      lat: parseFloat(stop.latitude),\n      lng: parseFloat(stop.longitude),\n    },\n  },\n}));\n\nconst parsedStops = myStops.map((parsed) => ({\n  id: parsed.properties.id,\n  description: parsed.description,\n  geometry: parsed.geometry.pos,\n}));\n\nconst stopDescriptions = [];\nfor (var i = 0; i < parsedStops.length; i++) {\n  stopDescriptions.push(parsedStops[i].description);\n}\n\nconst routesArray = [];\nconst duplicateRoutes = [];\nfor (var j = 0; j < myStops.length; j++) {\n  routesArray.push(myStops[j].properties.routes);\n}\nfor (var k = 0; k < routesArray.length; k++) {\n  for (var l = 0; l < routesArray[k].length; l++) {\n    duplicateRoutes.push(routesArray[k][l]);\n  }\n}\nconst allRoutes = duplicateRoutes.filter(\n  (a, b) => duplicateRoutes.indexOf(a) === b\n);\n\n// Main function for the SPA, generating the Map/Page.\nexport default function App() {\n  const { isLoaded, loadError } = useLoadScript({\n    googleMapsApiKey: googleMapApiKey,\n    libraries,\n  });\n  const center = dublinCenter;\n  // eslint-disable-next-line\n  const [zoom, setZoom] = useState(11); // removing unwanted warning.\n  // The general things we need to track in state:\n  const [selectedPlace, setSelectedPlace] = useState(null);\n  const [markerMap, setMarkerMap] = useState({});\n  const [infoOpen, setInfoOpen] = useState(false);\n  const [geoMarkers, setGeoMarkers] = useState([]);\n  const [stopMarkers, setStopMarkers] = useState([]);\n  // eslint-disable-next-line\n  const [selected, setSelected] = useState(null); // removing unwanted warning.\n  // Consider removing this variable stopNumber, see if it can be merged with either originNumber or destinationNumber.\n  // eslint-disable-next-line\n  const [stopNumber, setStopNumber] = useState(0); // removing unwanted warning.\n  // These are being used to track selected stop numbers\n  const [originNumber, setOriginNumber] = useState(0);\n  const [destinationNumber, setDestinationNumber] = useState(0);\n  // This is used to track the string value of selected routes.\n  const [routeString, setRouteString] = useState(\"\");\n  // The things for Directions (Service and Renderer) we need to track in state.\n  const [response, setResponse] = useState(null);\n  const [responseValidator, setResponseValidator] = useState(false);\n  const [origin, setOrigin] = useState(\"\");\n  const [destination, setDestination] = useState(\"\");\n  // This is being used to track in state which set of markers is displayed. (Clusters or Route Markers)\n  const [markerSelection, setMarkerSelection] = useState(true);\n  // The things for selected time (Hour, Day, Month) we need to track in state.\n  const [selectedTime, setSelectedTime] = useState(new Date());\n  // Setting the time, day and month values as the current time.\n  // This allows for user to make prediction for journey that occurs at\n  // this time without having to select the time.\n  const initialTime = selectedTime.toTimeString().substring(0, 2);\n  const initialMinute = selectedTime.toTimeString().substring(3, 5);\n  console.log(selectedTime.toTimeString().substring(3, 5));\n  const [initialDay, initialMonth] = selectedTime.toDateString().split(\" \");\n  // An array containing time data for model input.\n  const [timeDayMonth, setTimeDayMonth] = useState([\n    initialTime,\n    initialMinute,\n    initialDay,\n    initialMonth,\n  ]);\n  // Track state of user selected routes and directions.\n  const [routeSelect, setRouteSelect] = React.useState(\"\");\n  const [directionSelect, setDirectionSelect] = React.useState(undefined);\n  // Track state of filtered bus stops.\n  const [filteredStops, setFilteredStops] = React.useState([]);\n  const [filteredStopsLatLng, setFilteredStopsLatLng] = React.useState([]);\n\n  const mapRef = React.useRef();\n  const onMapLoad = React.useCallback((map) => {\n    mapRef.current = map;\n  }, []);\n\n  // Orient the map to selected location.\n  const panTo = React.useCallback(({ lat, lng }) => {\n    mapRef.current.panTo({ lat, lng });\n    mapRef.current.setZoom(16);\n    setDestination(\"\");\n    setStopMarkers((current) => [...current, { lat: lat, lng: lng }]);\n  }, []);\n\n  // Orient the map to selected location.\n  const panToGeoMarker = React.useCallback(({ lat, lng }) => {\n    mapRef.current.panTo({ lat, lng });\n    mapRef.current.setZoom(16);\n    // Resetting the drawn route anytime this functions is called.\n    setDestination(\"\");\n    setGeoMarkers((current) => [...current, { lat: lat, lng: lng }]);\n  }, []);\n\n  // We have to create a mapping of our places to actual Marker objects\n  const markerLoadHandler = (marker, stop) => {\n    return setMarkerMap((prevState) => {\n      return { ...prevState, [stop.properties.id]: marker };\n    });\n  };\n\n  const markerClickHandler = (event, place) => {\n    // Remember which stop was clicked\n    setSelectedPlace(place);\n    // Required so clicking a 2nd marker works as expected\n    if (infoOpen) {\n      setInfoOpen(false);\n    }\n    setInfoOpen(true);\n  };\n\n  // Changing stop realtime info based on user choice.\n  const stopChoice = (number) => {\n    setStopNumber(() => parseInt(number.id));\n  };\n  // Changing origin info based on user choice.\n  const originChoice = (address) => {\n    // console.log(\"originChoice triggered\", address);\n    setOrigin(() => address);\n    // setOrigin(() => address.results[0].formatted_address);\n  };\n  // Changing destination info based on user choice.\n  const destinationChoice = (address) => {\n    // console.log(\"destinationChoice triggered\", address);\n    setDestination(() => address);\n    // setDestination(() => address.results[0].formatted_address);\n  };\n  // Changing stops of route displayed on based on user choice.\n  const routeChoice = (route) => {\n    setRouteString(() => route.routeString);\n  };\n\n  const [distance, setDistance] = React.useState(null);\n\n  // For generating a directions route on the map.\n  const directionsCallback = React.useCallback(\n    (response) => {\n      // This is the array you want associated with\n      // the response instead of the one that google assigns.\n      const selectedRouteArray = [];\n      const notSelectedRouteArray = [];\n      var aCounter = 0;\n      if (response !== null && responseValidator === false) {\n        if (response.status === \"OK\") {\n          for (var i = 0; i < response.routes.length; i++) {\n            for (var j = 0; j < response.routes[i].legs.length; j++) {\n              for (\n                var k = 0;\n                k < response.routes[i].legs[j].steps.length;\n                k++\n              ) {\n                if (\n                  // making sure that WALKING is excluded since it will not contain bus name information\n                  String(response.routes[i].legs[j].steps[k].travel_mode) ===\n                    \"TRANSIT\" &&\n                  // locating the first occurence of the users selected route\n                  String(\n                    response.routes[i].legs[j].steps[k].transit.line.short_name\n                  ) === routeSelect.toLowerCase()\n                ) {\n                  aCounter++;\n                  selectedRouteArray.push(response.routes[i]);\n                } else if (\n                  // making sure that WALKING is excluded since it will not contain bus name information\n                  String(response.routes[i].legs[j].steps[k].travel_mode) ===\n                    \"TRANSIT\" &&\n                  // locating the first occurence of the users selected route\n                  String(\n                    response.routes[i].legs[j].steps[k].transit.line.short_name\n                  ) !== routeSelect\n                ) {\n                  notSelectedRouteArray.push(response.routes[i]);\n                }\n              }\n            }\n          }\n          if (aCounter >= 1) {\n            // setting the routes array to be the one containing our desired bus route.\n            response.routes = selectedRouteArray;\n          } else {\n            // setting the routes array to be the next avaialable bus route\n            response.routes = notSelectedRouteArray;\n          }\n          setResponse(() => ({\n            response,\n          }));\n          setResponseValidator(true);\n        }\n        if (aCounter >= 1) {\n          setDistance(() => ({\n            selectedRouteArray: selectedRouteArray,\n          }));\n        } else {\n          setDistance(() => ({\n            selectedRouteArray: notSelectedRouteArray,\n          }));\n        }\n      }\n    },\n    // // here we are listening for changes in response\n    // // how about we make it to listen for changes in a variable\n    // eslint-disable-next-line\n    [response, distance, responseValidator] // react-hooks/exhaustive-deps\n  );\n\n  //  For which set of markers to display (Clusters or Route Markers).\n  const markerSelectionChoice = () => {\n    setMarkerSelection(() => false);\n  };\n\n  // For setting the selected origin stop number in state.\n  const originNumberChoice = (number) => {\n    console.log(\"originNumberChoice\", number);\n    setOriginNumber(() => parseInt(number.id));\n  };\n  // For setting the selected destination stop number in state.\n  const destinationNumberChoice = (number) => {\n    console.log(\"destinationNumberChoice\", number);\n    setDestinationNumber(() => parseInt(number.id));\n  };\n\n  // For setting the time in state.\n  const timeChoice = (selectedTime) => {\n    if (selectedTime === null) {\n      console.log(\"this dut has activated\");\n      const errorHandledDate = new Date();\n      const time = errorHandledDate.toTimeString().substring(0, 2);\n      const minute = errorHandledDate.toTimeString().substring(3, 5);\n      const [day, month] = errorHandledDate.toDateString().split(\" \");\n      setSelectedTime(errorHandledDate);\n      setTimeDayMonth([time, minute, day, month]);\n    } else {\n      const time = selectedTime.toTimeString().substring(0, 2);\n      const minute = selectedTime.toTimeString().substring(3, 5);\n      const [day, month] = selectedTime.toDateString().split(\" \");\n      setSelectedTime(selectedTime);\n      setTimeDayMonth([time, minute, day, month]);\n    }\n  };\n  // console.log(\"These are the time values: date-day-month\", timeDayMonth);\n\n  const filteredStopsChoice = (filteredMarkers) => {\n    setFilteredStops(() => filteredMarkers);\n  };\n\n  const filteredStopsLatLngChoice = (filteredMarkers) => {\n    setFilteredStopsLatLng(() => filteredMarkers);\n  };\n\n  // Orient the map to the selected route.\n  // Will need to have passed in to it an array of stop locations.\n  const panTwo = React.useCallback(\n    // For some reason there is delay in this function receiving filteredStopsLatLng.\n    // You had this problem before, with the time. How the hell did you fix that?!\n    () => {\n      // console.log(newBounds, \"here is geometry in panTwo in App.js\");\n      // mapRef.current.fitBounds(newBounds);\n      // mapRef.current.setZoom(12);\n      // Resetting the drawn route anytime this functions is called.\n      setDestination(\"\");\n    },\n    []\n  );\n\n  if (loadError) return \"Error\";\n  // if (!isLoaded) return <Loader type=\"line-scale\" active />;+\n  if (!isLoaded)\n    return (\n      <Spinner animation=\"border\" role=\"status\">\n        <span className=\"sr-only\">Loading...</span>\n      </Spinner>\n    );\n\n  return (\n    <Container fluid>\n      <Row>\n        <Col sm={12}>\n          <CustomNavBar\n            // Passing in props - Custom built components.\n            FilterRoute={FilterRoute}\n            StopSearch={StopSearch}\n            // Passing in props - Functions defined above.\n            panTo={panTo}\n            stopChoice={stopChoice}\n            routeChoice={routeChoice}\n            panTwo={panTwo}\n            // Passing in props - Stop data defined above.\n            parsedStops={parsedStops}\n            stopDescriptions={stopDescriptions}\n            allRoutes={allRoutes}\n          />\n        </Col>\n      </Row>\n      <Row>\n        <Col lg={9}>\n          {/* Render the Google Map */}\n          <GoogleMap\n            // Inbuilt props: https://react-google-maps-api-docs.netlify.app/#googlemap.\n            mapContainerStyle={mapContainerStyle}\n            center={center}\n            zoom={zoom}\n            options={mapOptions}\n            onLoad={onMapLoad}\n          >\n            <Locate\n              // Passing in props - Functions defined above.\n              panToGeoMarker={panToGeoMarker}\n              setResponse={setResponse}\n            />\n            <RouteInfo\n              // Passing in props - Functions defined above.\n              markerLoadHandler={markerLoadHandler}\n              markerClickHandler={markerClickHandler}\n              markerSelectionChoice={markerSelectionChoice}\n              filteredStopsLatLngChoice={filteredStopsLatLngChoice}\n              mapRef={mapRef}\n              // Passing in props - Stop data defined above.\n              routeString={routeString}\n              routeSelect={routeSelect}\n              filteredStopsChoice={filteredStopsChoice}\n            />\n            <ClusteredMarkers\n              // Passing in props - Functions defined above.\n              markerLoadHandler={markerLoadHandler}\n              markerClickHandler={markerClickHandler}\n              markerSelection={markerSelection}\n              // Passing in props - Stop data defined above.\n              myStops={myStops}\n              setFilteredStops={setFilteredStops}\n            />\n            {infoOpen && selectedPlace && (\n              <InfoWindow\n                // Inbuilt props: https://react-google-maps-api-docs.netlify.app/#infowindow.\n                anchor={markerMap[selectedPlace.properties.id]}\n                onCloseClick={() => setInfoOpen(false)}\n              >\n                <div>\n                  <h5>\n                    {selectedPlace.properties.fullname +\n                      \", stop \" +\n                      selectedPlace.properties.id}\n                  </h5>\n                  <RtpiApi\n                    // Passing in props - Stop data defined above.\n                    number={selectedPlace.properties.id}\n                  />\n                </div>\n              </InfoWindow>\n            )}\n            {/* Markers dropped when  geolocation activated. */}\n            {geoMarkers.map((marker) => (\n              <Marker\n                // Inbuilt props: https://react-google-maps-api-docs.netlify.app/#marker.\n                key={`${marker.lat}-${marker.lng}`}\n                position={{ lat: marker.lat, lng: marker.lng }}\n                icon={{\n                  url: \"http://maps.google.com/mapfiles/ms/icons/blue-dot.png\",\n                }}\n                onClick={() => {\n                  setSelected(marker);\n                }}\n              />\n            ))}\n            {/* Markers dropped when stop has been chosen. */}\n\n            {stopMarkers.map((marker) => (\n              <Marker\n                // Inbuilt props: https://react-google-maps-api-docs.netlify.app/#marker.\n                key={`${marker.lat}-${marker.lng}`}\n                position={{ lat: marker.lat, lng: marker.lng }}\n                icon={{\n                  url: \"http://maps.google.com/mapfiles/ms/icons/red-dot.png\",\n                }}\n                onClick={() => {\n                  setSelected(marker);\n                }}\n              />\n            ))}\n            {destination !== \"\" && origin !== \"\" && (\n              <DirectionsService\n                // Inbuilt props: https://react-google-maps-api-docs.netlify.app/#directionsservice.\n                options={{\n                  destination: destination,\n                  origin: origin,\n                  travelMode: \"TRANSIT\",\n                  provideRouteAlternatives: true,\n                  transitOptions: {\n                    modes: [\"BUS\"],\n                    routingPreference: \"FEWER_TRANSFERS\",\n                    // arrivalTime: new Date(1337675679473),\n                    departureTime: selectedTime,\n                  },\n                  // transitDetails: { trip_short_name: \"145\" },\n                }}\n                // required\n                callback={directionsCallback}\n              />\n            )}\n            {response !== null && (\n              <DirectionsRenderer\n                // Inbuilt props: https://react-google-maps-api-docs.netlify.app/#directionsrenderer.\n                // required\n                options={{\n                  directions: response.response,\n                  // hideRouteList: true,\n                  polylineOptions: {\n                    strokeColor: \"red\",\n                    strokeWeight: 5,\n                  },\n                  suppressInfoWindows: true,\n                  suppressMarkers: false,\n                }}\n                // panel={document.getElementById(\"panel\")}\n                // removing all displayed stops upon loading\n                onLoad={() => {\n                  // setRouteSelect(\"\");\n                  setRouteString(\"\");\n                  setMarkerSelection(false);\n                }}\n              />\n            )}\n          </GoogleMap>\n        </Col>\n        <Col\n          lg={3}\n          // CSS\n          style={{ paddingTop: \"2vh\" }}\n        >\n          <PredictionInput\n            // Passing in props - Functions defined above.\n            panTo={panTo}\n            panTwo={panTwo}\n            originChoice={originChoice}\n            destinationChoice={destinationChoice}\n            originNumberChoice={originNumberChoice}\n            destinationNumberChoice={destinationNumberChoice}\n            timeChoice={timeChoice}\n            routeChoice={routeChoice}\n            // Passing in props - Variables defined above.\n            setResponseValidator={setResponseValidator}\n            setStopMarkers={setStopMarkers}\n            setRouteString={setRouteString}\n            setGeoMarkers={setGeoMarkers}\n            setMarkerSelection={setMarkerSelection}\n            setFilteredStops={setFilteredStops}\n            setOrigin={setOrigin}\n            setDestination={setDestination}\n            originNumber={originNumber}\n            destinationNumber={destinationNumber}\n            selectedTime={selectedTime}\n            setSelectedTime={setSelectedTime}\n            timeDayMonth={timeDayMonth}\n            setTimeDayMonth={setTimeDayMonth}\n            routeSelect={routeSelect}\n            setRouteSelect={setRouteSelect}\n            directionSelect={directionSelect}\n            setDirectionSelect={setDirectionSelect}\n            setResponse={setResponse}\n            // Passing in props - Directions response defined above.\n            distance={distance}\n            // Passing in props - Stop data defined above.\n            parsedStops={parsedStops}\n            stopDescriptions={stopDescriptions}\n            allRoutes={allRoutes}\n            filteredStops={filteredStops}\n            filteredStopsLatLng={filteredStopsLatLng}\n          />\n          <div id=\"panel\"></div>\n        </Col>\n      </Row>\n    </Container>\n  );\n}\n\n// Function that filters the markers on the map\n// according to a user selected route.\nfunction RouteInfo(props) {\n  // i want to be able to define this variable outside of this function.\n  // but it has to be populated in here.\n  // when it has been populated it shoiuld be set in App.\n  const filteredMarkers = [];\n  const filteredStopStrings = [];\n  const filteredStopsCoords = [];\n\n  for (var i = 0; i < myStops.length; i++) {\n    for (var j = 0; j < myStops[i].properties.routes.length; j++) {\n      if (String(myStops[i].properties.routes[j]) === props.routeString) {\n        filteredMarkers.push(myStops[i]);\n        filteredStopStrings.push(myStops[i].description);\n        filteredStopsCoords.push(myStops[i].geometry.pos);\n      }\n    }\n  }\n\n  const uniqueMarkers = filteredMarkers.filter(\n    (a, b) => filteredMarkers.indexOf(a) === b\n  );\n\n  const bounds = new window.google.maps.LatLngBounds(); // create an empty new bounds object\n  for (i = 0; i < filteredStopsCoords.length; i++) {\n    bounds.extend(filteredStopsCoords[i]);\n  }\n  if (String(props.routeString) !== \"\") {\n    // console.log(filteredMarkers);\n    return uniqueMarkers.map((stop) => (\n      <Marker\n        icon={icon}\n        key={stop.properties.id}\n        position={stop.geometry.pos}\n        onLoad={(marker) => {\n          props.filteredStopsLatLngChoice(filteredStopsCoords);\n          props.filteredStopsChoice(filteredStopStrings);\n          // Will do for now - removing cluster upon selection of route.\n          props.markerSelectionChoice(false);\n          props.markerLoadHandler(marker, stop);\n          // Changing the bounds to fit map to chosen route's markers.\n          props.mapRef.current.fitBounds(bounds);\n          props.mapRef.current.setZoom(13);\n        }}\n        onClick={(event) => {\n          props.markerClickHandler(event, stop);\n        }}\n        animation={window.google.maps.Animation.DROP}\n      />\n    ));\n  } else {\n    return null;\n  }\n}\n\n// Function that renders all of the Dublin Bus stops in clustered form.\n// props.markerSelection being set to True means that they will all be displayed on\n// the first load. When a route is chosen from the RouteInfo function above,\n// props.markerSelection gets set to False and all of the markers are removed. This solution\n// is intended only to be temporary until something better comes up.\nfunction ClusteredMarkers(props) {\n  if (props.markerSelection === true) {\n    return (\n      <MarkerClusterer options={options} maxZoom={15} minimumClusterSize={4}>\n        {(clusterer) =>\n          props.myStops.map((stop) => (\n            <Marker\n              icon={icon}\n              key={stop.properties.id}\n              position={stop.geometry.pos}\n              clusterer={clusterer}\n              onLoad={(marker) => props.markerLoadHandler(marker, stop)}\n              onClick={(event) => props.markerClickHandler(event, stop)}\n            />\n          ))\n        }\n      </MarkerClusterer>\n    );\n  } else {\n    return null;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}